<!DOCTYPE html>
<html class="" lang="fr"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="UTF-8">
	<title>Architecture d'un site web&nbsp;: manipulation des données — Alexandre Niveau — Université de Caen Normandie</title>

	<meta name="author" content="Alexandre Niveau">
	<meta name="company" content="Université de Caen">
	<meta name="viewport" content="initial-scale=1">


	<link rel="stylesheet" href="Architecture%20d'un%20site%20web%20manipulation%20des%20donn%C3%A9es%20%E2%80%94%20Alexandre%20Niveau%20%E2%80%94%20Universit%C3%A9%20de%20Caen%20Normandie_files/normalize.css">
	<link rel="stylesheet" href="Architecture%20d'un%20site%20web%20manipulation%20des%20donn%C3%A9es%20%E2%80%94%20Alexandre%20Niveau%20%E2%80%94%20Universit%C3%A9%20de%20Caen%20Normandie_files/slides_alex.css">
	<link rel="icon" type="image/png" href="https://ensweb.users.info.unicaen.fr/TW4B/ui/images/favicon.png">

	<!-- STYLES POUR DEMO -->
	<style>
.horiz {
  display: flex;
  flex-flow: row wrap;
}
.horiz h4 {
  text-align: center;
	margin: .2em auto;
}
	</style></head>
<body>
<header class="title slide">
	<h1>Architecture d'un site web&nbsp;: manipulation des données</h1>
	<div class="auteur">Alexandre Niveau</div>
	<div class="affiliation">GREYC — Université de Caen</div>
	<div class="proj_switch"><button title="basculer entre mode normal et mode projection (raccourci clavier «&nbsp;m&nbsp;»)">Changer de mode</button></div>
</header>

<div id="contenu">
<div id="presentation" class="hidenotes">


<div class="note">
TODO:
<ul><li>
 Gros problème : on ne peut pas décemment
expliquer doctement que l'escape on input c'est pas bien, et utiliser 
directement PHP comme moteur de templates.
L'échappement à la sortie n'est viable qu'avec un très bon système 
d'affichage qui échappe par défaut. Mais pour être utilisable il faut 
qu'il rende possible d'inclure facilement des bouts de HTML qui eux-même
 utilisent des variables et doivent donc les échapper, et là tout de 
suite c'est un autre projet.
</li><li>La vue du site des couleurs est quand même assez dégueu.

</li></ul></div>

<!-- ########################################################################### -->

<div class="slide">
<h2>Un petit point</h2>
<div class="p">Rappels sur notre architecture
<ul>
<li>modèle&nbsp;: logique métier. API séparée de l'affichage et du contrôle.</li>
<li>vue&nbsp;: gestion de l'affichage HTML en fonction de l'état du modèle.</li>
<li>contrôleur&nbsp;: modifie le modèle et construit la vue adaptée en fonction
des actions de l'internaute.</li>
<li>routeur&nbsp;: interprète les requêtes HTTP comme des actions, appelle le contrôleur,
et affiche la vue.</li>
</ul>
</div>
<div class="p">Appliquée sur l'exemple très simple des poèmes&nbsp;:
<ul><li>le routeur regarde le poème demandé dans l'URL</li>
<li>il demande au contrôleur de s'en occuper</li>
<li>le contrôleur récupère le poème dans le modèle</li>
<li>et le passe à la vue</li>
</ul>
</div>
</div>

<!-- ########################################################################### -->

<div class="slide">
<h2>CRUD</h2>
<ul>
<li>Les sites web interactifs doivent faire beaucoup plus que ça</li>
<li>Opérations de base sur les objets&nbsp;: CRUD, <i>create, read, update, delete</i></li>
<li>On va présenter comment appliquer notre architecture à ces problèmes
avec l'exemple d'un site où les internautes peuvent proposer des noms
à des couleurs</li>
</ul>
</div>


<!-- ########################################################################### -->

<div class="slide">
<h2>Règle d'or</h2>
<blockquote>Tout ce qui vient du client est <strong>dangereux</strong>, il faut
systématiquement s'en méfier.
</blockquote>
</div>



<!-- ########################################################################### -->

<div class="slide">
<h2>Affichage</h2>
<ul><li>La règle d'or nous dit qu'il ne faut pas afficher n'importe comment les données
qui viennent (potentiellement) du client. </li>
<li>L'internaute peut mettre du HTML (et donc du JavaScript) dans ses données&nbsp;:
les afficher directement, c'est compromettre tous les utilisateurs&nbsp;!</li>
<li>Pour afficher des données qui viennent des clients dans une page HTML,
il faut échapper les caractères spéciaux du HTML en les remplaçant par des
entités HTML&nbsp;: <code>&lt;</code> par <code>&amp;lt;</code>, <code>&amp;</code>
par <code>&amp;amp;</code>, etc.</li>
<li>La fonction PHP <code>htmlspecialchars</code> s'occupe de ça, mais il faut
préciser certaines options&nbsp;:
<div class="src hl "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$texte&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Du&nbsp;texte&nbsp;&amp;&nbsp;de&nbsp;l'&lt;abbr&gt;HTML&lt;/abbr&gt;."</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$utf8inv&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Un&nbsp;caractère&nbsp;"'</span><span style="color: #007700">.</span><span style="color: #0000BB">hex2bin</span><span style="color: #007700">(</span><span style="color: #DD0000">"C0"</span><span style="color: #007700">).</span><span style="color: #DD0000">'"&nbsp;invalide.'</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #DD0000">"1.&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$texte</span><span style="color: #007700">).</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #DD0000">"2.&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$utf8inv</span><span style="color: #007700">).</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #DD0000">"3.&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$texte</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">|</span><span style="color: #0000BB">ENT_SUBSTITUTE</span><span style="color: #007700">|</span><span style="color: #0000BB">ENT_HTML5</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">).</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #DD0000">"4.&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$utf8inv</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">|</span><span style="color: #0000BB">ENT_SUBSTITUTE</span><span style="color: #007700">|</span><span style="color: #0000BB">ENT_HTML5</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">).</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
<pre class="src "><code>1. Du texte &amp;amp; de l'&amp;lt;abbr&amp;gt;HTML&amp;lt;/abbr&amp;gt;.
2. 
3. Du texte &amp;amp; de l&amp;apos;&amp;lt;abbr&amp;gt;HTML&amp;lt;/abbr&amp;gt;.
4. Un caractère &amp;quot;�&amp;quot; invalide.
</code></pre>
<div class="demo ">
1. Du texte &amp; de l'&lt;abbr&gt;HTML&lt;/abbr&gt;.
2. 
3. Du texte &amp; de l'&lt;abbr&gt;HTML&lt;/abbr&gt;.
4. Un caractère "�" invalide.

</div>
</li>
<li><code>ENT_QUOTES</code> encode les apostrophes, <code>ENT_SUBSTITUTE</code>
remplace les séquences UTF-8 invalides par le caractère � (U+FFFD)
plutôt que de retourner une chaîne vide,
et <code>ENT_HTML5</code> utilise la table d'encodage d'HTML5.</li>
</ul>
</div>

<!-- ########################################################################### -->

<div class="slide">
<h2>Échappement à l'entrée</h2>
<figure class="side">
<img src="Architecture%20d'un%20site%20web%20manipulation%20des%20donn%C3%A9es%20%E2%80%94%20Alexandre%20Niveau%20%E2%80%94%20Universit%C3%A9%20de%20Caen%20Normandie_files/html_escape_fail.png" alt="Entité HTML brodée sur un T-shirt" width="400">
<figcaption>Échappement à l'entrée&nbsp;: échec.
(<a href="https://instagram.com/p/SVfQruppEE/">Source</a>)
</figcaption>
</figure>
<ul>
<li>Attention, la façon d'échapper la sortie dépend de ce qu'on affiche.</li>
<li>Par ex., pour
une sortie en mode texte, on ne veut pas échapper les caractères spéciaux.</li>
<li> ⇒ il ne faut <strong>pas</strong> échapper les données en entrée,
(et les stocker par exemple dans une base de données)&nbsp;:
on ne sait pas ce qu'on voudra en faire plus tard.</li>
<li>
<a href="http://lukeplant.me.uk/blog/posts/why-escape-on-input-is-a-bad-idea/">
Un article sur le sujet</a></li>
</ul>
</div>


<!-- ########################################################################### -->

<div class="slide">
<h2>Structure des répertoires</h2>
<pre>src/
|-- Router.php
|-- ctl/
|   `-- Controller.php
|-- lib/
|   `-- ObjectFileDB.php
|-- model/
|   |-- Color.php
|   |-- ColorStorage.php
|   `-- ColorStorageFile.php
`-- view/
    `-- MainView.php
</pre>
<p>On retrouve la même structure que précédemment</p>
<ul>
<li>La classe <code>Color</code> représente une couleur. On peut modifier son nom et sa valeur hexadécimale.
On peut récupérer d'autres informations, comme les dates de création/modification et différents formats
de couleur.</li>
<li>L'interface <code>ColorStorage</code> gère le stockage des couleurs enregistrées. C'est elle qui est manipulée
par les autres composants, sans qu'ils ne connaissent l'implémentation réelle.</li>
<li>La classe <code>ColorStorageFile</code> est une implémentation de <code>ColorStorage</code>, qui n'utilise pas de BD
mais un simple fichier texte (manipulé à l'aide de <a href="https://ensweb.users.info.unicaen.fr/TW4B/pres/crud/file_store.php">la classe <code>ObjectFileDB</code></a>).
Pour le reste de l'application, ça ne change rien (puisque c'est l'interface qui est utilisée).</li>
<!-- <li>La classe <code>ColorForm</code> permet de manipuler les couleurs en cours de création/modification.</li> -->
<!-- <li>Le répertoire <code>skin</code> contiendra tous les éléments de style : CSS, images de fond, polices, etc.</li> -->
<li>Le reste est identique à ce qui a été vu en CM/TP.</li>
</ul>
</div>

<!-- ########################################################################### -->

<!--
<div class="slide">
<h2>Protéger ses répertoires</h2>
<ul>
<li>Le site n'est censé être accessible que par <code>index.php</code></li>
<li>Si les utilisateurs essaient d'aller voir d'autres fichiers, ils auront
des pages incomplètes ou vides</li>
<li>Ils ne pourront normalement pas voir le code PHP, mais c'est potentiellement un problème
de sécurité.</li>
<li>Il faut donc interdire l'accès aux répertoires ne contenant que du code
<ul>
<li>Se fait normalement dans la configuration du serveur</li>
<li>Si pas accès, utilisation de fichiers Apache
<code>.htaccess</code></li>
</ul></li></ul>
TODO: ce qui suit ne marche en fait pas ! le pattern est matché contre
l'url entière. si on mettait ^/config$ ça ne marcherait pas,
et si on laissait comme ça mais qu'on avait une URL qui contient /config
quelque part, ça ferait 404.
</div>
-->

<!-- ########################################################################### -->

<div class="slide">
<h2>Le modèle</h2>
<p>Pour illustrer la séparation des responsabilités, on va considérer que les classes
<code>Color</code> et <code>ColorStorageFile</code>
ainsi que les feuilles de style  ont été écrites par d'autres.
On ne les modifiera pas.</p>
<h3>Classe <code>Color</code></h3>
<div class="src hl long"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">/*&nbsp;Représente&nbsp;une&nbsp;couleur.&nbsp;*/<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Color&nbsp;</span><span style="color: #007700">{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$hex</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$creationDate</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$modifDate</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Construit&nbsp;une&nbsp;couleur.&nbsp;Si&nbsp;les&nbsp;paramètres&nbsp;de&nbsp;date&nbsp;ne&nbsp;sont&nbsp;pas&nbsp;passés,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;la&nbsp;couleur&nbsp;est&nbsp;considérée&nbsp;comme&nbsp;étant&nbsp;toute&nbsp;nouvelle.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Le&nbsp;nom&nbsp;et&nbsp;le&nbsp;code&nbsp;hexa&nbsp;doivent&nbsp;être&nbsp;valides,&nbsp;au&nbsp;sens<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;de&nbsp;isNameValid&nbsp;et&nbsp;isHexValid,&nbsp;sinon&nbsp;une&nbsp;exception&nbsp;est&nbsp;levée.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$hex</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$creationDate</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$modifDate</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">isNameValid</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">Exception</span><span style="color: #007700">(</span><span style="color: #DD0000">"Invalid&nbsp;color&nbsp;name"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">isHexValid</span><span style="color: #007700">(</span><span style="color: #0000BB">$hex</span><span style="color: #007700">))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">Exception</span><span style="color: #007700">(</span><span style="color: #DD0000">"Invalid&nbsp;hex"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hex&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$hex</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">creationDate&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$creationDate&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">$creationDate</span><span style="color: #007700">:&nbsp;new&nbsp;</span><span style="color: #0000BB">DateTime</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">modifDate&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$modifDate&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">$modifDate</span><span style="color: #007700">:&nbsp;new&nbsp;</span><span style="color: #0000BB">DateTime</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getName</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Renvoie&nbsp;le&nbsp;code&nbsp;hexadécimal&nbsp;de&nbsp;la&nbsp;couleur,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;sous&nbsp;forme&nbsp;de&nbsp;chaîne&nbsp;d'exactement&nbsp;6&nbsp;chiffres&nbsp;hexa.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getHex</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hex</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Renvoie&nbsp;le&nbsp;code&nbsp;RGB&nbsp;de&nbsp;la&nbsp;couleur&nbsp;sous&nbsp;forme&nbsp;de&nbsp;tableau&nbsp;[r,&nbsp;g,&nbsp;b]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;d'entiers&nbsp;entre&nbsp;0&nbsp;et&nbsp;255.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getRGB</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">base_convert</span><span style="color: #007700">(</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hex</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">16</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">base_convert</span><span style="color: #007700">(</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hex</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">16</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">base_convert</span><span style="color: #007700">(</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hex</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">16</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Renvoie&nbsp;le&nbsp;code&nbsp;HSL&nbsp;(teinte,&nbsp;saturation,&nbsp;luminosité)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;de&nbsp;la&nbsp;couleur&nbsp;sous&nbsp;forme&nbsp;de&nbsp;tableau&nbsp;d'entiers&nbsp;[h,&nbsp;s,&nbsp;l],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;avec&nbsp;h&nbsp;entre&nbsp;0&nbsp;et&nbsp;359,&nbsp;et&nbsp;s&nbsp;et&nbsp;l&nbsp;entre&nbsp;0&nbsp;et&nbsp;100.&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getHSL</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;adapté&nbsp;de&nbsp;http://www.easyrgb.com/index.php?X=MATH&amp;H=18&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$rgb&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getRGB</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;/&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$g&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;/&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$b&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]&nbsp;/&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$min&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">min</span><span style="color: #007700">(</span><span style="color: #0000BB">$r</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$g</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$max&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">max</span><span style="color: #007700">(</span><span style="color: #0000BB">$r</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$g</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$delta&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$max&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$min</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;luminosité&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$l&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">$max&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">$min</span><span style="color: #007700">)&nbsp;/&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$delta&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;c'est&nbsp;du&nbsp;gris&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$h&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$s&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;saturation&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$l&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">0.5</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$s&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$delta&nbsp;</span><span style="color: #007700">/&nbsp;(</span><span style="color: #0000BB">$max&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">$min</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$s&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$delta&nbsp;</span><span style="color: #007700">/&nbsp;(</span><span style="color: #0000BB">2&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$max&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$min</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;teinte&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$dr&nbsp;</span><span style="color: #007700">=&nbsp;((</span><span style="color: #0000BB">$max&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$r</span><span style="color: #007700">)&nbsp;/&nbsp;</span><span style="color: #0000BB">6&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">$delta&nbsp;</span><span style="color: #007700">/&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">)&nbsp;/&nbsp;</span><span style="color: #0000BB">$delta</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$dg&nbsp;</span><span style="color: #007700">=&nbsp;((</span><span style="color: #0000BB">$max&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$g</span><span style="color: #007700">)&nbsp;/&nbsp;</span><span style="color: #0000BB">6&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">$delta&nbsp;</span><span style="color: #007700">/&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">)&nbsp;/&nbsp;</span><span style="color: #0000BB">$delta</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;((</span><span style="color: #0000BB">$max&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">)&nbsp;/&nbsp;</span><span style="color: #0000BB">6&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">$delta&nbsp;</span><span style="color: #007700">/&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">)&nbsp;/&nbsp;</span><span style="color: #0000BB">$delta</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$max</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$h&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$dg</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(</span><span style="color: #0000BB">$g&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$max</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$h&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">/</span><span style="color: #0000BB">3&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">$dr&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(</span><span style="color: #0000BB">$b&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$max</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$h&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">/</span><span style="color: #0000BB">3&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">$dg&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$dr</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;normalisation&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$h&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$h&nbsp;</span><span style="color: #007700">+=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$h&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$h&nbsp;</span><span style="color: #007700">-=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span><span style="color: #0000BB">round</span><span style="color: #007700">(</span><span style="color: #0000BB">$h</span><span style="color: #007700">*</span><span style="color: #0000BB">360</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">round</span><span style="color: #007700">(</span><span style="color: #0000BB">$s</span><span style="color: #007700">*</span><span style="color: #0000BB">100</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">round</span><span style="color: #007700">(</span><span style="color: #0000BB">$l</span><span style="color: #007700">*</span><span style="color: #0000BB">100</span><span style="color: #007700">));<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Renvoie&nbsp;un&nbsp;objet&nbsp;DateTime&nbsp;correspondant&nbsp;à<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;la&nbsp;création&nbsp;de&nbsp;la&nbsp;couleur.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getCreationDate</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">creationDate</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Renvoie&nbsp;un&nbsp;objet&nbsp;DateTime&nbsp;correspondant&nbsp;à<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;la&nbsp;dernière&nbsp;modification&nbsp;de&nbsp;la&nbsp;couleur.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getModifDate</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">modifDate</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Modifie&nbsp;le&nbsp;nom&nbsp;de&nbsp;la&nbsp;couleur.&nbsp;Le&nbsp;nouveau&nbsp;nom&nbsp;doit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;être&nbsp;valide&nbsp;au&nbsp;sens&nbsp;de&nbsp;isNameValid,&nbsp;sinon<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;une&nbsp;exception&nbsp;est&nbsp;levée.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">setName</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">isNameValid</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">Exception</span><span style="color: #007700">(</span><span style="color: #DD0000">"Invalid&nbsp;color&nbsp;name"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">modifDate&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DateTime</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Modifie&nbsp;le&nbsp;code&nbsp;hexadécimal&nbsp;de&nbsp;la&nbsp;couleur.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Le&nbsp;nouveau&nbsp;code&nbsp;doit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;être&nbsp;valide&nbsp;au&nbsp;sens&nbsp;de&nbsp;isHexValid,&nbsp;sinon<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;une&nbsp;exception&nbsp;est&nbsp;levée.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">setHex</span><span style="color: #007700">(</span><span style="color: #0000BB">$hex</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">isHexValid</span><span style="color: #007700">(</span><span style="color: #0000BB">$hex</span><span style="color: #007700">))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">Exception</span><span style="color: #007700">(</span><span style="color: #DD0000">"Invalid&nbsp;hex"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hex&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$hex</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">modifDate&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DateTime</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Indique&nbsp;si&nbsp;$name&nbsp;est&nbsp;un&nbsp;nom&nbsp;valide&nbsp;pour&nbsp;une&nbsp;couleur.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Il&nbsp;doit&nbsp;faire&nbsp;moins&nbsp;de&nbsp;30&nbsp;caractères,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;et&nbsp;ne&nbsp;pas&nbsp;être&nbsp;vide.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">isNameValid</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">mb_strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">)&nbsp;&lt;&nbsp;</span><span style="color: #0000BB">30&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Indique&nbsp;si&nbsp;$hex&nbsp;est&nbsp;un&nbsp;code&nbsp;hexadécimal&nbsp;valide.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;On&nbsp;accepte&nbsp;uniquement&nbsp;6&nbsp;chiffres&nbsp;hexadécimaux<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;(mais&nbsp;peu&nbsp;importe&nbsp;la&nbsp;casse)&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">isHexValid</span><span style="color: #007700">(</span><span style="color: #0000BB">$hex</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">preg_match</span><span style="color: #007700">(</span><span style="color: #DD0000">"/^[0-9a-f]{6}$/i"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$hex</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>}<br><br></span><span style="color: #0000BB">?&gt;<br></span>
</span>
</code></div>
<h3 id="ColorStorageFile">Classe <code>ColorStorageFile</code></h3>
<div class="src hl long"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">require_once(</span><span style="color: #DD0000">"lib/ObjectFileDB.php"</span><span style="color: #007700">);<br>require_once(</span><span style="color: #DD0000">"model/Color.php"</span><span style="color: #007700">);<br>require_once(</span><span style="color: #DD0000">"model/ColorStorage.php"</span><span style="color: #007700">);<br><br><br><br><br></span><span style="color: #FF8000">/*<br>&nbsp;*&nbsp;Gère&nbsp;le&nbsp;stockage&nbsp;de&nbsp;couleurs&nbsp;dans&nbsp;un&nbsp;fichier.<br>&nbsp;*&nbsp;Plus&nbsp;simple&nbsp;que&nbsp;l'utilisation&nbsp;d'une&nbsp;base&nbsp;de&nbsp;données,<br>&nbsp;*&nbsp;car&nbsp;notre&nbsp;application&nbsp;est&nbsp;très&nbsp;simple.<br>&nbsp;*/<br><br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">ColorStorageFile&nbsp;</span><span style="color: #007700">implements&nbsp;</span><span style="color: #0000BB">ColorStorage&nbsp;</span><span style="color: #007700">{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;le&nbsp;ObjectFileDB&nbsp;dans&nbsp;lequel&nbsp;l'instance&nbsp;est&nbsp;enregistrée&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">private&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Construit&nbsp;une&nbsp;nouvelle&nbsp;instance,&nbsp;qui&nbsp;utilise&nbsp;le&nbsp;fichier&nbsp;donné<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;en&nbsp;paramètre.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">ObjectFileDB</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Insère&nbsp;une&nbsp;nouvelle&nbsp;couleur&nbsp;dans&nbsp;la&nbsp;base.&nbsp;Renvoie&nbsp;l'identifiant<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;de&nbsp;la&nbsp;nouvelle&nbsp;couleur.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">create</span><span style="color: #007700">(</span><span style="color: #0000BB">Color&nbsp;$c</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">insert</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Renvoie&nbsp;la&nbsp;couleur&nbsp;d'identifiant&nbsp;$id,&nbsp;ou&nbsp;null<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;si&nbsp;l'identifiant&nbsp;ne&nbsp;correspond&nbsp;à&nbsp;aucune&nbsp;couleur.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">read</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">exists</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Renvoie&nbsp;un&nbsp;tableau&nbsp;associatif&nbsp;id&nbsp;=&gt;&nbsp;Color<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;contenant&nbsp;toutes&nbsp;les&nbsp;couleurs&nbsp;de&nbsp;la&nbsp;base.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">readAll</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Met&nbsp;à&nbsp;jour&nbsp;une&nbsp;couleur&nbsp;dans&nbsp;la&nbsp;base.&nbsp;Renvoie<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;true&nbsp;si&nbsp;la&nbsp;modification&nbsp;a&nbsp;été&nbsp;effectuée,&nbsp;false<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;si&nbsp;l'identifiant&nbsp;ne&nbsp;correspond&nbsp;à&nbsp;aucune&nbsp;couleur.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">update</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Color&nbsp;$c</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">exists</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">update</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$c</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Supprime&nbsp;une&nbsp;couleur.&nbsp;Renvoie<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;true&nbsp;si&nbsp;la&nbsp;suppression&nbsp;a&nbsp;été&nbsp;effectuée,&nbsp;false<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;si&nbsp;l'identifiant&nbsp;ne&nbsp;correspond&nbsp;à&nbsp;aucune&nbsp;couleur.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">delete</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">exists</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">delete</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Vide&nbsp;la&nbsp;base.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">deleteAll</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">deleteAll</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br></span><span style="color: #0000BB">?&gt;<br></span>
</span>
</code></div>
</div>

<!-- ########################################################################### -->


<!-- ########################################################################### -->

<div class="slide">
<h2>MVCR initial</h2>
<h3>Routeur</h3>
<div class="src hl long full"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">require_once(</span><span style="color: #DD0000">"model/ColorStorage.php"</span><span style="color: #007700">);<br>require_once(</span><span style="color: #DD0000">"view/MainView.php"</span><span style="color: #007700">);<br>require_once(</span><span style="color: #DD0000">"ctl/Controller.php"</span><span style="color: #007700">);<br><br><br>class&nbsp;</span><span style="color: #0000BB">Router&nbsp;</span><span style="color: #007700">{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">ColorStorage&nbsp;$colordb</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">colordb&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$colordb</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">main</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$view&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MainView</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ctl&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Controller</span><span style="color: #007700">(</span><span style="color: #0000BB">$view</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">colordb</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Analyse&nbsp;de&nbsp;l'URL&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$colorId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'couleur'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">)?&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'couleur'</span><span style="color: #007700">]:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$action&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'action'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">)?&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'action'</span><span style="color: #007700">]:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$action&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Pas&nbsp;d'action&nbsp;demandée&nbsp;:&nbsp;par&nbsp;défaut&nbsp;on&nbsp;affiche<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;la&nbsp;page&nbsp;d'accueil,&nbsp;sauf&nbsp;si&nbsp;une&nbsp;couleur&nbsp;est&nbsp;demandée,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;auquel&nbsp;cas&nbsp;on&nbsp;affiche&nbsp;sa&nbsp;page.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$action&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">$colorId&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)?&nbsp;</span><span style="color: #DD0000">"accueil"</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">"voir"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(</span><span style="color: #0000BB">$action</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #DD0000">"voir"</span><span style="color: #007700">:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$colorId&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$view</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">makeUnknownActionPage</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ctl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">colorPage</span><span style="color: #007700">(</span><span style="color: #0000BB">$colorId</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #DD0000">"galerie"</span><span style="color: #007700">:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ctl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">allColorsPage</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #DD0000">"accueil"</span><span style="color: #007700">:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$view</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">makeHomePage</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;L'internaute&nbsp;a&nbsp;demandé&nbsp;une&nbsp;action&nbsp;non&nbsp;prévue.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$view</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">makeUnknownActionPage</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Si&nbsp;on&nbsp;arrive&nbsp;ici,&nbsp;il&nbsp;s'est&nbsp;passé&nbsp;quelque&nbsp;chose&nbsp;d'imprévu<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;(par&nbsp;exemple&nbsp;un&nbsp;problème&nbsp;de&nbsp;base&nbsp;de&nbsp;données)&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$view</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">makeUnexpectedErrorPage</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Enfin,&nbsp;on&nbsp;affiche&nbsp;la&nbsp;page&nbsp;préparée&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$view</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">render</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;URL&nbsp;de&nbsp;la&nbsp;page&nbsp;d'accueil&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">homePage</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"."</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;URL&nbsp;de&nbsp;la&nbsp;page&nbsp;de&nbsp;la&nbsp;couleur&nbsp;d'identifiant&nbsp;$id&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">colorPage</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">".?couleur=</span><span style="color: #0000BB">$id</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;URL&nbsp;de&nbsp;la&nbsp;page&nbsp;avec&nbsp;toutes&nbsp;les&nbsp;couleurs&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">allColorsPage</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">".?action=galerie"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>}<br><br></span><span style="color: #0000BB">?&gt;<br></span>
</span>
</code></div>
<h3>Vue</h3>
<div class="src hl long full"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">require_once(</span><span style="color: #DD0000">"Router.php"</span><span style="color: #007700">);<br>require_once(</span><span style="color: #DD0000">"model/Color.php"</span><span style="color: #007700">);<br><br>class&nbsp;</span><span style="color: #0000BB">MainView&nbsp;</span><span style="color: #007700">{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$router</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$style</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$title</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$content</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">Router&nbsp;$router</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">router&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$router</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">style&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">title&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/******************************************************************************/<br>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Méthodes&nbsp;de&nbsp;génération&nbsp;des&nbsp;pages&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;/******************************************************************************/<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">makeHomePage</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">title&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Proposez&nbsp;vos&nbsp;couleurs&nbsp;!"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Bienvenue&nbsp;sur&nbsp;ce&nbsp;site&nbsp;de&nbsp;partage&nbsp;de&nbsp;couleurs."</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">makeColorPage</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Color&nbsp;$c</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">htmlesc</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getName</span><span style="color: #007700">());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$chex&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getHex</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$crgb&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getRGB</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$chsl&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getHSL</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cclass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"color</span><span style="color: #0000BB">$id</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cdatec&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">fmtDate</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getCreationDate</span><span style="color: #007700">());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cdatem&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">fmtDate</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getModifDate</span><span style="color: #007700">());<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">style&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">".</span><span style="color: #0000BB">$cclass</span><span style="color: #DD0000">&nbsp;{&nbsp;background-color:&nbsp;#</span><span style="color: #0000BB">$chex</span><span style="color: #DD0000">;&nbsp;}"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">title&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"La&nbsp;couleur&nbsp;</span><span style="color: #0000BB">$cname</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$s&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$s&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;figure&gt;\n&lt;div&nbsp;class=\"sample&nbsp;</span><span style="color: #0000BB">$cclass</span><span style="color: #DD0000">\"&gt;&lt;/div&gt;\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$s&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;figcaption&gt;Un&nbsp;échantillon&nbsp;de&nbsp;</span><span style="color: #0000BB">$cname</span><span style="color: #DD0000">.&lt;/figcaption&gt;\n&lt;/figure&gt;\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$s&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;La&nbsp;couleur&nbsp;</span><span style="color: #0000BB">$cname</span><span style="color: #DD0000">&nbsp;a&nbsp;pour&nbsp;code&nbsp;hexadécimal&nbsp;</span><span style="color: #0000BB">$chex</span><span style="color: #DD0000">.&lt;/p&gt;\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$s&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;Elle&nbsp;contient&nbsp;du&nbsp;rouge&nbsp;à&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">round</span><span style="color: #007700">(</span><span style="color: #0000BB">$crgb</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]*</span><span style="color: #0000BB">100</span><span style="color: #007700">/</span><span style="color: #0000BB">255</span><span style="color: #007700">).</span><span style="color: #DD0000">"%,&nbsp;du&nbsp;vert&nbsp;à&nbsp;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$s&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #0000BB">round</span><span style="color: #007700">(</span><span style="color: #0000BB">$crgb</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]*</span><span style="color: #0000BB">100</span><span style="color: #007700">/</span><span style="color: #0000BB">255</span><span style="color: #007700">).</span><span style="color: #DD0000">"%,&nbsp;et&nbsp;du&nbsp;bleu&nbsp;à&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">round</span><span style="color: #007700">(</span><span style="color: #0000BB">$crgb</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]*</span><span style="color: #0000BB">100</span><span style="color: #007700">/</span><span style="color: #0000BB">255</span><span style="color: #007700">).</span><span style="color: #DD0000">"%.&lt;/p&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$s&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;Sa&nbsp;teinte&nbsp;est&nbsp;de&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$chsl</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">].</span><span style="color: #DD0000">"°,&nbsp;avec&nbsp;une&nbsp;saturation&nbsp;de&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$chsl</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$s&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"%&nbsp;et&nbsp;une&nbsp;luminosité&nbsp;de&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$chsl</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">].</span><span style="color: #DD0000">"%.&lt;/p&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$s&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;Elle&nbsp;a&nbsp;été&nbsp;créée&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$cdatec</span><span style="color: #007700">.</span><span style="color: #DD0000">"&nbsp;et&nbsp;modifiée&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$cdatem</span><span style="color: #007700">.</span><span style="color: #DD0000">"&lt;/p&gt;\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$s</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">makeGalleryPage</span><span style="color: #007700">(array&nbsp;</span><span style="color: #0000BB">$colors</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">title&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Toutes&nbsp;les&nbsp;couleurs"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;Cliquer&nbsp;sur&nbsp;une&nbsp;couleur&nbsp;pour&nbsp;voir&nbsp;des&nbsp;détails.&lt;/p&gt;\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;ul&nbsp;class=\"gallery\"&gt;\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$colors&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$c</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">galleryColor</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$c</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;/ul&gt;\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">makeUnknownColorPage</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">title&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Erreur"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"La&nbsp;couleur&nbsp;demandée&nbsp;n'existe&nbsp;pas."</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">makeUnknownActionPage</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">title&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Erreur"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"La&nbsp;page&nbsp;demandée&nbsp;n'existe&nbsp;pas."</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Génère&nbsp;une&nbsp;page&nbsp;d'erreur&nbsp;inattendue.&nbsp;Peut&nbsp;optionnellement<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;prendre&nbsp;l'exception&nbsp;qui&nbsp;a&nbsp;provoqué&nbsp;l'erreur<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;en&nbsp;paramètre,&nbsp;mais&nbsp;n'en&nbsp;fait&nbsp;rien&nbsp;pour&nbsp;l'instant.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">makeUnexpectedErrorPage</span><span style="color: #007700">(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">title&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Erreur"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Une&nbsp;erreur&nbsp;inattendue&nbsp;s'est&nbsp;produite."</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/******************************************************************************/<br>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Méthodes&nbsp;utilitaires&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;/******************************************************************************/<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;function&nbsp;</span><span style="color: #0000BB">getMenu</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"Accueil"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">router</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">homePage</span><span style="color: #007700">(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"Couleurs"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">router</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">allColorsPage</span><span style="color: #007700">(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;</span><span style="color: #0000BB">galleryColor</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$c</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cclass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"color"</span><span style="color: #007700">.</span><span style="color: #0000BB">$id</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">style&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$cclass</span><span style="color: #007700">.</span><span style="color: #DD0000">'&nbsp;{&nbsp;background-color:&nbsp;#'</span><span style="color: #007700">.</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getHex</span><span style="color: #007700">().</span><span style="color: #DD0000">';&nbsp;}'</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'&lt;li&gt;&lt;a&nbsp;href="'</span><span style="color: #007700">.</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">router</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">colorPage</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">).</span><span style="color: #DD0000">'"&gt;'</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'&lt;h3&gt;'</span><span style="color: #007700">.</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">htmlesc</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getName</span><span style="color: #007700">()).</span><span style="color: #DD0000">'&lt;/h3&gt;'</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'&lt;div&nbsp;class="sample&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">$cclass</span><span style="color: #007700">.</span><span style="color: #DD0000">'"&gt;&lt;/div&gt;'</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'&lt;/a&gt;&lt;/li&gt;'</span><span style="color: #007700">.</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">fmtDate</span><span style="color: #007700">(</span><span style="color: #0000BB">DateTime&nbsp;$date</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"le&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$date</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">format</span><span style="color: #007700">(</span><span style="color: #DD0000">"Y-m-d"</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;à&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$date</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">format</span><span style="color: #007700">(</span><span style="color: #DD0000">"H:i:s"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Une&nbsp;fonction&nbsp;pour&nbsp;échapper&nbsp;les&nbsp;caractères&nbsp;spéciaux&nbsp;de&nbsp;HTML,<br>&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;car&nbsp;celle&nbsp;de&nbsp;PHP&nbsp;nécessite&nbsp;trop&nbsp;d'options.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">htmlesc</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;on&nbsp;échappe&nbsp;guillemets&nbsp;_et_&nbsp;apostrophes&nbsp;:&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ENT_QUOTES<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;les&nbsp;séquences&nbsp;UTF-8&nbsp;invalides&nbsp;sont<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;remplacées&nbsp;par&nbsp;le&nbsp;caractère&nbsp;�<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;au&nbsp;lieu&nbsp;de&nbsp;renvoyer&nbsp;la&nbsp;chaîne&nbsp;vide…)&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">ENT_SUBSTITUTE<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;on&nbsp;utilise&nbsp;les&nbsp;entités&nbsp;HTML5&nbsp;(en&nbsp;particulier&nbsp;&amp;apos;)&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">ENT_HTML5</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/******************************************************************************/<br>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Rendu&nbsp;de&nbsp;la&nbsp;page&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;/******************************************************************************/<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">render</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">title&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">||&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">makeUnexpectedErrorPage</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;On&nbsp;affiche&nbsp;la&nbsp;page.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Ici&nbsp;on&nbsp;pourrait&nbsp;faire&nbsp;des&nbsp;echo,&nbsp;mais&nbsp;simplement&nbsp;fermer<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;la&nbsp;balise&nbsp;PHP&nbsp;revient&nbsp;au&nbsp;même,&nbsp;et&nbsp;le&nbsp;HTML&nbsp;est&nbsp;plus&nbsp;lisible.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;En&nbsp;revanche&nbsp;le&nbsp;code&nbsp;PHP&nbsp;est&nbsp;moins&nbsp;lisible&nbsp;:&nbsp;une&nbsp;autre&nbsp;solution<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;est&nbsp;de&nbsp;mettre&nbsp;ce&nbsp;squelette&nbsp;dans&nbsp;un&nbsp;fichier&nbsp;à&nbsp;part&nbsp;et<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;de&nbsp;simplement&nbsp;faire&nbsp;un&nbsp;«include»&nbsp;(c'est&nbsp;ce&nbsp;qui&nbsp;a&nbsp;été&nbsp;fait&nbsp;pour&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;le&nbsp;site&nbsp;des&nbsp;poèmes).&nbsp;*/<br></span><span style="color: #0000BB">?&gt;<br></span>&lt;!DOCTYPE&nbsp;html&gt;<br>&lt;html&nbsp;lang="fr"&gt;<br>&lt;head&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">title</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">?&gt;</span>&lt;/title&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;charset="UTF-8"&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;link&nbsp;rel="stylesheet"&nbsp;href="skin/screen.css"&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;<br><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">style</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">?&gt;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;nav&nbsp;class="menu"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&gt;<br><span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">/*&nbsp;Construit&nbsp;le&nbsp;menu&nbsp;à&nbsp;partir&nbsp;d'un&nbsp;tableau&nbsp;associatif&nbsp;texte=&gt;lien.&nbsp;*/<br></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMenu</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$text&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;li&gt;&lt;a&nbsp;href=\"</span><span style="color: #0000BB">$link</span><span style="color: #DD0000">\"&gt;</span><span style="color: #0000BB">$text</span><span style="color: #DD0000">&lt;/a&gt;&lt;/li&gt;"</span><span style="color: #007700">;<br>}<br></span><span style="color: #0000BB">?&gt;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/nav&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;main&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;h1&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">title</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">?&gt;</span>&lt;/h1&gt;<br><span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content</span><span style="color: #007700">;<br></span><span style="color: #0000BB">?&gt;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/main&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #FF8000">/*&nbsp;fin&nbsp;de&nbsp;l'affichage&nbsp;de&nbsp;la&nbsp;page&nbsp;et&nbsp;fin&nbsp;de&nbsp;la&nbsp;méthode&nbsp;render()&nbsp;*/<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br><br>}<br><br></span><span style="color: #0000BB">?&gt;<br></span>
</span>
</code></div>
<h3>Contrôleur</h3>
<div class="src hl long full"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">/***&nbsp;Contrôleur&nbsp;du&nbsp;site&nbsp;des&nbsp;couleurs.&nbsp;***/<br><br>/*&nbsp;Inclusion&nbsp;des&nbsp;classes&nbsp;nécessaires&nbsp;*/<br></span><span style="color: #007700">require_once(</span><span style="color: #DD0000">"model/Color.php"</span><span style="color: #007700">);<br>require_once(</span><span style="color: #DD0000">"model/ColorStorage.php"</span><span style="color: #007700">);<br>require_once(</span><span style="color: #DD0000">"view/MainView.php"</span><span style="color: #007700">);<br><br><br>class&nbsp;</span><span style="color: #0000BB">Controller&nbsp;</span><span style="color: #007700">{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$colordb</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">MainView&nbsp;$view</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ColorStorage&nbsp;$colordb</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">v&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$view</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">colordb&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$colordb</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">colorPage</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Une&nbsp;couleur&nbsp;est&nbsp;demandée,&nbsp;on&nbsp;la&nbsp;récupère&nbsp;en&nbsp;BD&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$color&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">colordb</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">read</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$color&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;La&nbsp;couleur&nbsp;n'existe&nbsp;pas&nbsp;en&nbsp;BD&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">v</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">makeUnknownColorPage</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;La&nbsp;couleur&nbsp;existe,&nbsp;on&nbsp;prépare&nbsp;la&nbsp;page&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">v</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">makeColorPage</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$color</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">allColorsPage</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$colors&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">colordb</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">readAll</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">v</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">makeGalleryPage</span><span style="color: #007700">(</span><span style="color: #0000BB">$colors</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>}<br><br></span><span style="color: #0000BB">?&gt;<br></span>
</span>
</code></div>
</div>

<!-- ########################################################################### -->

<div class="slide">
<h2>Vue et contrôleur pour CRUD basique</h2>
<p>Voilà donc la structure de laquelle on part. Le résultat
est <a href="https://ensweb.users.info.unicaen.fr/TW4B/pres/crud/couleurs_ini/">visible ici</a>, et le code peut être récupéré
dans <a href="https://ensweb.users.info.unicaen.fr/TW4B/pres/crud/couleurs_ini.zip">cette archive</a>.</p>
<p>Encore une fois, j'ai utilisé des paramètres d'URL dans un souci de simplicité
dans l'implémentation, mais il n'est vraiment pas difficile de mettre en place
des URL plus propres en utilisant <code>$_SERVER['PATH_INFO']</code></p>
<div class="p">On va améliorer progressivement le site en ajoutant une gestion basique
 des points suivants&nbsp;:
<ul>
<li>suppression d'une couleur</li>
<li>création d'une couleur</li>
<li>modification d'une couleur</li>
</ul>
</div>
<!-- <p>Les prochains transparents discutent des problématiques liées à ces manipulations.</p> -->
</div>

<!-- ########################################################################### -->

<div class="slide">
<h2>Suppression d'une couleur</h2>
<p>C'est le cas le plus simple&nbsp;: on n'a presque rien à faire</p>
<p>Le contrôleur supprime la couleur en BD, et indique à l'internaute si
tout s'est bien passé</p>
<p>On va quand même améliorer un peu l'ergonomie en demander à l'internaute
de confirmer son choix avant d'effectuer la suppression</p>
<p>Notre page de suppression sera donc une page normale (accédée en GET),
avec un bouton pour confirmer la suppression (qui utilisera POST)</p>
</div>

<!-- ########################################################################### -->

<div class="slide">
<h2>Création/modification d'une couleur</h2>
<ul>
<li>Création/modification d'une couleur = formulaire</li>
<li>Les champs du formulaire constituent une nouvelle «&nbsp;interface&nbsp;» pour les couleurs,
en plus de celle de la classe <code>Color</code> (modèle) et de
celle de l'objet en BD (qui est cachée dans <code>ColorStorage</code>).</li>
<li>On ne peut pas se contenter de manipuler des instances de <code>Color</code>,
car les données issues des formulaires sont potentiellement <em>incomplètes ou fausses</em>.</li>
<li>On va donc manipuler des instances d'une nouvelle classe, <code>ColorBuilder</code>, qui
va encapsuler le tableau associatif récupéré du client</li>
<li>Comme son nom l'indique, le travail de <code>ColorBuilder</code> est de
 construire une nouvelle instance de <code>Color</code> à partir
des données qu'on lui a fournies.</li>
<li class="conseq"><code>ColorBuilder</code> peut-il faire confiance aux données fournies&nbsp;?</li>
<!--
3 types d'interface pour les objets:
* l'objet en BD
* l'objet en formulaire HTML
* l'objet dans le modèle

le 3e n'est pas vital, surtout s'il n'y a pas vraiment de logique métier.
on peut se contenter d'utiliser un même tableau associatif pour les 2 derniers types.
-->
</ul>
</div>


<!-- ########################################################################### -->

<div class="slide">
<h2>Validation des données</h2>
<ul>
<li>On peut utiliser la validation côté client, mais il ne faut pas oublier
la règle d'or&nbsp;! Ici le corollaire est qu'on va systématiquement revalider les
données côté serveur.</li>
<li class="conseq">C'est le <code>ColorBuilder</code> qui sait construire
une couleur, c'est donc également lui qui s'occupera de valider les données</li>
<li>En cas de problème, il faut
reproposer à l'internaute le formulaire pré-rempli, en lui précisant
ce qui ne va pas.</li>
<li class="conseq"><code>ColorBuilder</code> aura des méthodes
de validation qui vont renvoyer un tableau avec les erreurs, tableau qui sera
utilisé par la vue pour avertir l'utilisateur.</li>
</ul>
</div>

<!-- ########################################################################### -->

<div class="slide">
<h2>Version finale… pour l'instant</h2>
<p>Le résultat auquel on arrive en suivant cette progression
est <a href="https://ensweb.users.info.unicaen.fr/TW4B/pres/crud/couleurs/">visible ici</a>, et le code peut être récupéré
dans <a href="https://ensweb.users.info.unicaen.fr/TW4B/pres/crud/couleurs.zip">cette archive</a>.</p>
<p>Ça marche… mais c'est encore très basique&nbsp;:
plusieurs fragilités au niveau de l'ergonomie (réfléchissez-y&nbsp;!)</p>
<p class="conseq">On verra un certain nombre d'améliorations dans le prochain cours</p>
</div>

</div> <!-- fin #presentation -->

<aside id="liens">
<h3>Spécifications et normes</h3>
<ul>
<li><a href="http://tools.ietf.org/html/rfc7231">HTTP/1.1: Semantics and content</a></li>
</ul>
<h3>Tutoriels</h3>
<ul>
<li><a href="http://kunststube.net/escapism/">The great escapism (or: what you need to know to work with text within text)</a></li>
</ul>
<h3>Lectures complémentaires</h3>
<ul>
<li><a href="http://lukeplant.me.uk/blog/posts/why-escape-on-input-is-a-bad-idea/">Why escape-on-input is a bad idea</a></li>
<li><a href="http://kunststube.net/encoding/">What every programmer needs to know about encodings and charsets to work with text</a> (avec des détails sur PHP)</li>
</ul>

</aside><!-- fin #liens -->
</div> <!-- fin #contenu -->

<footer class="license">
	<a class="icone" rel="license" href="http://creativecommons.org/licenses/by/4.0/">
		<img alt="Licence Creative Commons CC-BY" style="border-width:0" src="Architecture%20d'un%20site%20web%20manipulation%20des%20donn%C3%A9es%20%E2%80%94%20Alexandre%20Niveau%20%E2%80%94%20Universit%C3%A9%20de%20Caen%20Normandie_files/88x31.png">
	</a>
	<p class="texte">
		Ce cours est mis à disposition selon les termes de la <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">licence Creative Commons Attribution 4.0 International</a>.
	</p></footer>
<script>
document.addEventListener("DOMContentLoaded", function () {
	function toggleProj() {
		const currentParams = new URLSearchParams(window.location.search);
		if (currentParams.get('mode') === 'proj') {
			console.log('found proj');
			document.documentElement.classList.remove('proj');
			currentParams.delete('mode');
		} else {
			console.log('not found proj');
			document.documentElement.classList.add('proj');
			currentParams.set('mode', 'proj');
		}
		window.history.pushState({}, '', '?' + currentParams + window.location.hash);
	};

	var buttons = document.querySelectorAll('.proj_switch button'), i;
	for (i = 0; i < buttons.length; ++i) {
		buttons[i].addEventListener("click", toggleProj);
	}

	document.addEventListener("keypress", function(e) {
		if (e.target == document.body && String.fromCharCode(e.keyCode || e.charCode) == "m") {
			toggleProj();
		}
	});

	/* ajout de liens aux titres qui ont un id */
	let slidesWithId = document.querySelectorAll('.slide[id]');
	for (const slide of slidesWithId) {
		const link = document.createElement('a');
		link.href = '#' + slide.id;
		link.classList.add('slide-link');
		link.title = 'Lien vers ce slide';
		link.textContent = '#';
		slide.insertAdjacentElement('afterbegin', link);
	}


});
</script>


</body></html>