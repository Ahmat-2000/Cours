<!DOCTYPE html>
<html class="" lang="fr"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="UTF-8">
	<title>Le modèle objet de PHP5 — Alexandre Niveau — Université de Caen Normandie</title>

	<meta name="author" content="Alexandre Niveau">
	<meta name="company" content="Université de Caen">
	<meta name="viewport" content="initial-scale=1">


	<link rel="stylesheet" href="Le%20mod%C3%A8le%20objet%20de%20PHP5%20%E2%80%94%20Alexandre%20Niveau%20%E2%80%94%20Universit%C3%A9%20de%20Caen%20Normandie_files/normalize.css">
	<link rel="stylesheet" href="Le%20mod%C3%A8le%20objet%20de%20PHP5%20%E2%80%94%20Alexandre%20Niveau%20%E2%80%94%20Universit%C3%A9%20de%20Caen%20Normandie_files/slides_alex.css">
	<link rel="icon" type="image/png" href="https://ensweb.users.info.unicaen.fr/TW4B/ui/images/favicon.png">

	<!-- STYLES POUR DEMO -->
	<style>
.output { color: white; background-color: #333; }
	</style></head>
<body>
<header class="title slide">
	<h1>Le modèle objet de PHP5</h1>
	<div class="auteur">Alexandre Niveau</div>
	<div class="affiliation">GREYC — Université de Caen</div>
	<div class="details">
		Adapté du cours de Jean-Marc Lecarpentier
	</div>	<div class="proj_switch"><button title="basculer entre mode normal et mode projection (raccourci clavier «&nbsp;m&nbsp;»)">Changer de mode</button></div>
</header>

<div id="contenu">
<div id="presentation" class="hidenotes">


<div class="slide note">
TODO:
<ul>
  <li> changer les exemples, qui sont encore compliqués pour être vraiment utilisables en CM
  </li><li> Carre extends Rectangle : mauvais exemple; trouver un mieux,
 ou parler explicitement des problèmes (dépend de l'API — si les 
instances sont immutables ça ne pose pas de problème)
</li></ul></div>


<!-- ########################################################################### -->
<!-- ########################################################################### -->

<div class="slide">
<h2>Programmation objet en PHP</h2>
<ul>
<li>La programmation objet a été ajoutée à PHP3, améliorée dans PHP4,
et complètement revue dans PHP5</li>
<li>Syntaxe et fonctionnement lourdement inspirés de Java</li>
<li>Remarque&nbsp;: les variables d'instance, appelées attributs en Java, sont appelées «&nbsp;propriétés&nbsp;» en PHP
</li>
</ul>
</div>



<!-- ########################################################################### -->
<!-- ########################################################################### -->

<div class="slide">
<h2>Une classe en PHP5</h2>
<div class="slidecontent">
<ul>
<li>Définition et utilisation d'une classe :
  <pre class="code src "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Rectangle&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$longueur</span><span style="color: #007700">;<br>&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$L</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$l</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">longueur&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$L</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">largeur&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$l</span><span style="color: #007700">;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getLongueur</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">longueur</span><span style="color: #007700">;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getLargeur</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">largeur</span><span style="color: #007700">;<br>&nbsp;&nbsp;}<br>}<br><br></span><span style="color: #0000BB">$c&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Rectangle</span><span style="color: #007700">(</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #DD0000">"Dimensions&nbsp;:&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLongueur</span><span style="color: #007700">()}</span><span style="color: #DD0000">x</span><span style="color: #007700">{</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLargeur</span><span style="color: #007700">()}</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #DD0000">"Erreur&nbsp;fatale&nbsp;:\n"</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #DD0000">"Dimensions&nbsp;:&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">longueur</span><span style="color: #007700">}</span><span style="color: #DD0000">x</span><span style="color: #007700">{</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">largeur</span><span style="color: #007700">}</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br></span>
</span>
</code></pre>
</li>
</ul>
</div>
</div>

<!-- ########################################################################### -->
<!-- ########################################################################### -->

<div class="slide">
<h2>Pièges des objets</h2>
<div class="p">Il faut obligatoirement utiliser <code>$this</code> dans une classe pour
faire référence aux propriétés et méthodes
<div class="src hl "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Toto&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$x&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">afficherX</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$x</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;(au&nbsp;lieu&nbsp;de&nbsp;$this-&gt;x)<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br>}<br></span><span style="color: #0000BB">$toto&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Toto</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$toto</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">afficherX</span><span style="color: #007700">();&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;lève&nbsp;une&nbsp;Notice:&nbsp;undefined&nbsp;variable&nbsp;$x</span>
</span>
</code></div>
</div>
<div class="p">Lors de la déclaration de la visibilité des propriétés, on leur met des <code>$</code>,
mais pas ailleurs. Cependant, mettre un <code>$</code> n'est pas une erreur de syntaxe, ça fait juste
autre chose que ce qu'on voudrait…
<div class="src hl "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Toto&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$x&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">;<br>}<br></span><span style="color: #0000BB">$toto&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Toto</span><span style="color: #007700">();<br>echo&nbsp;</span><span style="color: #0000BB">$toto</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">x</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;affiche&nbsp;3<br></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$toto</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">$x</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;lève&nbsp;une&nbsp;Notice:&nbsp;undefined&nbsp;variable&nbsp;$x<br><br></span><span style="color: #0000BB">$variable&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"x"</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #0000BB">$toto</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">$variable</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;affiche&nbsp;3&nbsp;:&nbsp;$toto-&gt;$variable&nbsp;est&nbsp;interprété&nbsp;comme&nbsp;$toto-&gt;x&nbsp;!</span>
</span>
</code></div>
</div>
<div class="p">Un foreach sur un objet parcourt ses propriétés&nbsp;:
<div class="src hl "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Toto&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$x&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$y&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'coucou'</span><span style="color: #007700">;<br>}<br></span><span style="color: #0000BB">$toto&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Toto</span><span style="color: #007700">();<br>foreach&nbsp;(</span><span style="color: #0000BB">$toto&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$k&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"clef&nbsp;</span><span style="color: #0000BB">$k</span><span style="color: #DD0000">,&nbsp;valeur&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br>}<br></span><span style="color: #FF8000">//&nbsp;résultat&nbsp;:<br>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clef&nbsp;x,&nbsp;valeur&nbsp;3<br>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clef&nbsp;y,&nbsp;valeur&nbsp;coucou</span>
</span>
</code></div>
</div>

</div>


<div class="slide">
<h2>Constructeur, destructeur, conversion en chaîne</h2>
<ul>
<li>Fonction <code>__construct()</code></li>
<li>Fonction <code>__destruct()</code>&nbsp;: appelée lorsque l'instance est détruite
(utilisation de <code>unset</code>, ou fin de l'exécution du script)</li>
<li>Fonction <code>__toString()</code>&nbsp;: appelée lorsque l'objet doit être converti
en chaîne de caractères
</li><li><em>Attention au double underscore du constructeur</em>, crée des bugs difficiles à trouver&nbsp;!
</li>
</ul>
<pre class="code src "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Point&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$x</span><span style="color: #007700">;<br>&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$y</span><span style="color: #007700">;<br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">___construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$y</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">x&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$x</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">y&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$y</span><span style="color: #007700">;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__toString</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"(</span><span style="color: #007700">{</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">x</span><span style="color: #007700">}</span><span style="color: #DD0000">,&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">y</span><span style="color: #007700">}</span><span style="color: #DD0000">)"</span><span style="color: #007700">;<br>&nbsp;&nbsp;}<br>}<br><br></span><span style="color: #0000BB">$p&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Point</span><span style="color: #007700">(</span><span style="color: #0000BB">3</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #0000BB">$p</span><span style="color: #007700">;<br></span>
</span>
</code></pre>
<pre class="output">(, )
</pre>
<p>Que s'est-il passé&nbsp;?</p>


</div>

<!-- ########################################################################### -->

<div class="slide">
<h2>Membres statiques</h2>
<div class="slidecontent">
<ul>
<li>Utilisation du mot clé <code>static</code></li>
<li>Une propriété statique a la même valeur pour toutes les instances de la classe</li>
<li>Une méthode statique peut être appelée sans avoir instancié la classe</li>

<li>Différences avec Java&nbsp;:
<ul>
<li>pas la même syntaxe pour l'accès aux propriétés et méthodes statiques&nbsp;: <em>double deux-points</em> à la place de la flèche</li>
<li>on n'appelle pas les propriétés et méthodes statiques avec <code>$this</code>, mais avec le mot-clef <code>self</code>,
qui représente «&nbsp;la classe de l'instance courante&nbsp;»</li>
</ul></li>
</ul>
</div>
<pre class="code src "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">//&nbsp;Exemple&nbsp;de&nbsp;classe&nbsp;avec&nbsp;des&nbsp;membres&nbsp;statiques<br><br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Toto&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;private&nbsp;static&nbsp;</span><span style="color: #0000BB">$compteur&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br>&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$dummy</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$contenu</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dummy&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$contenu</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$compteur</span><span style="color: #007700">++;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">printInstanceStats</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$this-&gt;compteur&nbsp;n'est&nbsp;pas&nbsp;défini&nbsp;=&gt;&nbsp;donne&nbsp;une&nbsp;chaine&nbsp;vide<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dummy&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"&nbsp;et&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">compteur&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">printClassStats</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//$this-&gt;dummy&nbsp;=&nbsp;"toto";&nbsp;&nbsp;//&nbsp;Fatal&nbsp;error<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #DD0000">"Il&nbsp;y&nbsp;a&nbsp;actuellement&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$compteur&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"&nbsp;instances&nbsp;de&nbsp;la&nbsp;classe&nbsp;Toto\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__destruct</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Destruction&nbsp;d'une&nbsp;instance\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$compteur</span><span style="color: #007700">--;<br>&nbsp;&nbsp;}<br>}<br><br>echo&nbsp;</span><span style="color: #0000BB">Toto</span><span style="color: #007700">::</span><span style="color: #0000BB">printClassStats</span><span style="color: #007700">();<br><br></span><span style="color: #0000BB">$A&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Toto</span><span style="color: #007700">(</span><span style="color: #DD0000">"instance&nbsp;A"</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #DD0000">"\$this-&gt;compteur&nbsp;n'est&nbsp;pas&nbsp;défini&nbsp;=&gt;&nbsp;donne&nbsp;une&nbsp;chaine&nbsp;vide&nbsp;et&nbsp;une&nbsp;Notice\n"</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #DD0000">"A&nbsp;:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$A</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">printInstanceStats</span><span style="color: #007700">();<br>echo&nbsp;</span><span style="color: #0000BB">Toto</span><span style="color: #007700">::</span><span style="color: #0000BB">printClassStats</span><span style="color: #007700">();<br><br></span><span style="color: #0000BB">$B&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Toto</span><span style="color: #007700">(</span><span style="color: #DD0000">"instance&nbsp;B"</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #DD0000">"\$this-&gt;compteur&nbsp;n'est&nbsp;pas&nbsp;défini&nbsp;=&gt;&nbsp;donne&nbsp;une&nbsp;chaine&nbsp;vide&nbsp;et&nbsp;une&nbsp;Notice\n"</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #DD0000">"B&nbsp;:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$B</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">printInstanceStats</span><span style="color: #007700">();<br>echo&nbsp;</span><span style="color: #0000BB">Toto</span><span style="color: #007700">::</span><span style="color: #0000BB">printClassStats</span><span style="color: #007700">();<br><br>echo&nbsp;</span><span style="color: #DD0000">"unset(\$A)\n"</span><span style="color: #007700">;<br>unset(</span><span style="color: #0000BB">$A</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #0000BB">Toto</span><span style="color: #007700">::</span><span style="color: #0000BB">printClassStats</span><span style="color: #007700">();<br><br>unset(</span><span style="color: #0000BB">$B</span><span style="color: #007700">);<br></span>
</span>
</code></pre>
<pre class="output">Il y a actuellement 0 instances de la classe Toto
$this-&gt;compteur n'est pas défini =&gt; donne une chaine vide et une Notice
A : instance A et 
Il y a actuellement 1 instances de la classe Toto
$this-&gt;compteur n'est pas défini =&gt; donne une chaine vide et une Notice
B : instance B et 
Il y a actuellement 2 instances de la classe Toto
unset($A)
Destruction d'une instance
Il y a actuellement 1 instances de la classe Toto
Destruction d'une instance

</pre>
</div>

<!-- ########################################################################### -->

<!-- ########################################################################### -->

<div class="slide">
<h2>Constante d'un objet</h2>
<ul>
<li>Définition avec <code>const</code></li>
<li>Comme pour les propriétés statiques, accès avec <code>::</code></li>
</ul>
<pre class="code src "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">MyClass&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;const&nbsp;</span><span style="color: #0000BB">ma_constante&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'toto'</span><span style="color: #007700">;<br>&nbsp;&nbsp;<br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">showConstant</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&nbsp;</span><span style="color: #DD0000">"Voici&nbsp;ma&nbsp;constante:&nbsp;"&nbsp;</span><span style="color: #007700">.</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">ma_constante&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">chgeConstant</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Fatal&nbsp;error&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;self::ma_constante&nbsp;=&nbsp;"test&nbsp;d'erreur";<br>&nbsp;&nbsp;</span><span style="color: #007700">}<br>}<br><br></span><span style="color: #0000BB">$obj&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MyClass</span><span style="color: #007700">();<br><br></span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">showConstant</span><span style="color: #007700">();<br><br>echo&nbsp;</span><span style="color: #DD0000">"MyClass::ma_constante&nbsp;:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">MyClass</span><span style="color: #007700">::</span><span style="color: #0000BB">ma_constante&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Fonctionne<br></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"\$obj-&gt;ma_constante&nbsp;:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ma_constante&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Ne&nbsp;fonctionne&nbsp;pas<br></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"\$obj::ma_constante&nbsp;:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$obj</span><span style="color: #007700">::</span><span style="color: #0000BB">ma_constante&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;Marche&nbsp;avec&nbsp;PHP&nbsp;&gt;&nbsp;5.3.0&nbsp;<br><br></span>
</span>
</code></pre>
</div>

<!-- ########################################################################### -->
<!-- ########################################################################### -->

<div class="slide">
<h2>Dérivation</h2>
<ul>
<li>Définition d'une classe dérivée avec <code>extends</code>
  <pre class="code src "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Rectangle&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$longueur</span><span style="color: #007700">;<br>&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$longueur</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">longueur&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$longueur</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">largeur&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">;<br>&nbsp;&nbsp;}<br><br>}<br><br>class&nbsp;</span><span style="color: #0000BB">Carre&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">Rectangle&nbsp;</span><span style="color: #007700">{<br><br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">);<br>&nbsp;&nbsp;}<br></span>
</span>
</code></pre>

</li><li>Contrairement à Java, constructeurs et destructeurs sont hérités&nbsp;: si non définis dans une sous-classe,
ce sont ceux du parent qui sont utilisés</li>
<li>En revanche, s'ils sont redéfinis, ils n'appellent pas automatiquement ceux du parent&nbsp;:
il faut le faire explicitement avec <code>parent::__construct()</code>
</li>
</ul>
</div>



<!-- ########################################################################### -->

<div class="slide">
<h2>Late static binding</h2>
<ul>
<li>Il existe une alternative à <code>self</code>&nbsp;: <code>static</code>
</li><li>Permet de résoudre «&nbsp;tardivement&nbsp;» une référence à un champ statique
</li><li class="conseq"><code>static::toto</code> n'est pas forcément le <code>toto</code> de la classe courante,
mais celui de la classe qui a effectivement été instanciée à l'exécution
</li><li><a href="https://www.php.net/manual/en/language.oop5.late-static-bindings.php">voir la doc</a></li>
<li>permet de faire de l'héritage sur les méthodes/propriétés statiques… Utile par exemple pour <a href="https://www.php.net/manual/en/language.oop5.late-static-bindings.php#114005">faire des <i>factory methods</i> statiques</a></li>
</ul>
</div>


<!-- ########################################################################### -->

<!-- ########################################################################### -->

<div class="slide">
<h2>Visibilité des membres</h2>
<div class="slidecontent">
<ul>
<li>3 niveaux :
<ul>
<li>public : accessible de partout</li>
<li>protected : accès limité à la classe et ses classes dérivées</li>
<li>private : accès seulement dans la classe</li>
</ul></li>
</ul>
<pre class="code src "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">MyClass<br></span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$public&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Public'</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$protected&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Protected'</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$private&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Private'</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">printHello</span><span style="color: #007700">()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">public</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">protected</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">private</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br></span><span style="color: #0000BB">$obj&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MyClass</span><span style="color: #007700">();<br>echo&nbsp;</span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">public</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;Works<br>//echo&nbsp;$obj-&gt;protected;&nbsp;//&nbsp;Fatal&nbsp;Error<br>//echo&nbsp;$obj-&gt;private;&nbsp;//&nbsp;Fatal&nbsp;Error<br></span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">printHello</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;Shows&nbsp;Public,&nbsp;Protected&nbsp;and&nbsp;Private<br><br><br>//&nbsp;classe&nbsp;dérivée<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">MyClass2&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">MyClass<br></span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;We&nbsp;can&nbsp;redeclare&nbsp;the&nbsp;public&nbsp;and&nbsp;protected&nbsp;method,&nbsp;but&nbsp;not&nbsp;private<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;</span><span style="color: #0000BB">$protected&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Protected2'</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">printHello</span><span style="color: #007700">()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">public</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">protected</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">private</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br></span><span style="color: #0000BB">$obj2&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MyClass2</span><span style="color: #007700">();<br>echo&nbsp;</span><span style="color: #0000BB">$obj2</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">public</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;Works<br></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$obj2</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">private</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;Undefined<br>//echo&nbsp;$obj2-&gt;protected;&nbsp;//&nbsp;Fatal&nbsp;Error<br></span><span style="color: #0000BB">$obj2</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">printHello</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;Shows&nbsp;Public,&nbsp;Protected2,&nbsp;not&nbsp;Private<br></span>
</span>
</code></pre>
<pre class="output">PublicPublicProtectedPrivatePublicPublicProtected2
</pre>
</div>
</div>

<!-- ########################################################################### -->

<!-- ########################################################################### -->

<div class="slide">
<h2>Encapsulation des données</h2>
<ul>
<li>Données membres non visibles de l'extérieur</li>
<li>Utilisation d'accesseurs et de mutateurs</li>
</ul>
<pre class="code src "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Rectangle&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$longueur</span><span style="color: #007700">;<br>&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$longueur</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">longueur&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$longueur</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">largeur&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Accesseurs&nbsp;<br><br>&nbsp;&nbsp;//&nbsp;Getters<br>&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getLongueur</span><span style="color: #007700">()&nbsp;{&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">longueur</span><span style="color: #007700">;&nbsp;}<br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getLargeur</span><span style="color: #007700">()&nbsp;{&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">largeur</span><span style="color: #007700">;&nbsp;}<br><br>&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Setters<br>&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">setLongueur</span><span style="color: #007700">(</span><span style="color: #0000BB">$longueur</span><span style="color: #007700">)&nbsp;{&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">longueur&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$longueur</span><span style="color: #007700">;&nbsp;}<br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">setLargeur</span><span style="color: #007700">(</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">)&nbsp;{&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">largeur&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">;&nbsp;}<br><br>}<br><br>class&nbsp;</span><span style="color: #0000BB">Carre&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">Rectangle&nbsp;</span><span style="color: #007700">{<br><br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">);<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">setLargeur</span><span style="color: #007700">(</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">setLongueur</span><span style="color: #007700">(</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">setLargeur</span><span style="color: #007700">(</span><span style="color: #0000BB">$largeur</span><span style="color: #007700">);<br>&nbsp;&nbsp;}<br>}<br><br><br>echo&nbsp;</span><span style="color: #DD0000">"Définition&nbsp;d'un&nbsp;rectangle&nbsp;5x2&nbsp;:\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$R&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Rectangle</span><span style="color: #007700">(</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br></span><span style="color: #FF8000">//&nbsp;echo&nbsp;$R-&gt;longueur;&nbsp;produit&nbsp;Fatal&nbsp;error<br>//&nbsp;Utiliser&nbsp;les&nbsp;accesseurs&nbsp;:<br></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"Longueur&nbsp;:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$R</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLongueur</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #DD0000">"Largeur&nbsp;:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$R</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLargeur</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br><br>echo&nbsp;</span><span style="color: #DD0000">"Définition&nbsp;d'un&nbsp;carré&nbsp;de&nbsp;largeur&nbsp;4\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$C&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Carre</span><span style="color: #007700">(</span><span style="color: #0000BB">4</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #DD0000">"Largeur&nbsp;:&nbsp;&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$C</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLargeur</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br><br>echo&nbsp;</span><span style="color: #DD0000">"Changement&nbsp;de&nbsp;la&nbsp;largeur&nbsp;:&nbsp;\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$C</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setLargeur</span><span style="color: #007700">(</span><span style="color: #0000BB">8</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #DD0000">"Largeur&nbsp;:&nbsp;&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$C</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLargeur</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #DD0000">"Longueur&nbsp;:&nbsp;&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$C</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLongueur</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br></span>
</span>
</code></pre>
<pre class="output">Définition d'un rectangle 5x2 :
Longueur : 5
Largeur : 2
Définition d'un carré de largeur 4
Largeur :  4
Changement de la largeur : 
Largeur :  8
Longueur :  8

</pre>
<p>Au passage, noter le mot-clef <code>parent</code>
pour appeler une méthode (ou le constructeur) de la superclasse</p>
</div>


<!-- ########################################################################### -->

<!-- #################################################################### -->
<!-- ########################################################################### -->

<div class="slide">
<h2>Exceptions&nbsp;: principe</h2>
<div class="slidecontent">
<ul>
<li>Quand on rencontre un problème dans son programme, au lieu de simplement l'arrêter,
on envoie une exception</li>
<li>L'envoi d'une exception arrête l'exécution du code en cours</li>
<li>L'intérêt est qu'il est possible de <em>récupérer</em> des exceptions qui ont été envoyées
par une partie de son programme, afin de traiter la source du problème (si c'est possible)
</li><li>Une exception non récupérée remonte à la fonction appelante, qui elle-même peut avoir
mis en place une récupération, etc.
</li><li>Si l'exception remonte «&nbsp;jusqu'en haut&nbsp;», le programme s'arrête avec une <br><em>Fatal error: Uncaught exception</em></li>
</ul>
</div>
</div>

<!-- ########################################################################### -->

<div class="slide">
<h2>Renvoyer une exception</h2>
<div class="slidecontent">
<ul>
<li><code>throw new Exception("Houston, we have a problem");</code></li>
<li>Classe Exception prédefinie dans PHP5</li>
<li>Méthodes ("final") :
<ul><li><code>getMessage()</code> : message d'erreur de l'exception</li>
<li><code>getCode()</code> : code d'erreur de l'exception</li>
<li><code>getFile()</code> : fichier dans lequel l'exception a été renvoyée</li>
<li><code>getLine()</code> : n° de ligne où l'exception a été renvoyée</li>
<li><code>getTrace()</code> :  tableau contenant la trace</li>
<li><code>getTraceAsString()</code> : chaîne de caractères avec la trace</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ########################################################################### -->


<!-- ########################################################################### -->

<div class="slide">
<h2>Essayer du code</h2>
<div class="slidecontent">
<ul>
<li>Pour pouvoir récupérer des exceptions, il faut placer le code PHP à exécuter dans un bloc <code>try</code></li>
<li>Tout envoi d'exception dans ce bloc interrompt l'exécution…</li>
<li>… mais le programme passe alors à la gestion de l'exception, qui suit</li>
</ul>
</div>
</div>

<!-- ########################################################################### -->

<div class="slide">
<h2>Attraper l'exception</h2>
<div class="slidecontent">
<ul>
<li>Un  bloc <code>try</code> doit être suivi d'un bloc <code>catch</code></li>
<li>Ce bloc "attrape" les exceptions éventuellement qui ont été renvoyées dans le bloc <code>try</code></li>
<li><pre class="src">try {
// code à exécuter
}
catch (Exception $e) {
   echo "Erreur, exception renvoyée : " . $e-&gt;getMessage();
}
</pre></li>
</ul>
</div>
</div>



<!-- ########################################################################### -->


<!-- ########################################################################### -->

<div class="slide">
<h2>Personnaliser ses exceptions</h2>
<div class="slidecontent">
<ul>
<li>Dériver la classe <code>Exception</code></li>
<li>Permet de créer différents types d'exceptions en utilisant plusieurs blocs <code>catch</code></li>
<li>Une exception non gérée dans un bloc <code>catch</code> est passée au bloc suivant</li>
</ul>
</div>
</div>

<!-- ########################################################################### -->


<!-- ########################################################################### -->

<!-- ########################################################################### -->

<!--
<div class="slide">
<h2>Gestion des erreurs</h2>
<div class="slidecontent">
<ul>
<li>Problème : mélange des erreurs et exceptions</li>
<li>Niveaux d'erreurs :
<ul>
  <li>Fatal Error : arrête le programme</li>
  <li>Warning : alerte, n'interrompt pas l'exécution</li>
  <li>Parse Error : erreur de syntaxe dans le programme</li>
  <li>Notice : non affichées par défaut, utile en développement</li>
</ul>
</li>
<li>Changer le niveau d'erreur à E_ALL avec un fichier .htaccess<br/>
<code>php_value error_reporting 2147483647</code> (-1 devrait marcher aussi)</li>
<li>Utilisation de xdebug</li>
</ul>
</div>
</div>
-->

<!-- ##################################################################### -->

<!--

<div class="slide">
<h2>Configurer votre serveur PHP</h2>
<div class="slidecontent">
Fichier php.ini :
<ul>
<li>short_open_tag</li>
<li>display_errors</li>
<li>error_reporting</li>
<li>magic_quotes_gpc Off</li>
<li>memory_limit</li>
<li>max_execution_time</li>
<li>post_max_size</li>
<li>upload_max_filesize</li>
</ul>
</div>
</div>

-->


<div class="slide note">
TODO:
  * traits
  * namespaces
  * stdclass ?
  * iterable
  * closure
</div>

<div class="slide">
<h2>Affichage debug d'un objet</h2>
<pre class="code src "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Titi&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$x&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$y&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$z&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">methode</span><span style="color: #007700">()&nbsp;{&nbsp;}<br>}<br><br>echo&nbsp;</span><span style="color: #DD0000">"----&nbsp;var_export&nbsp;----\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">var_export</span><span style="color: #007700">(new&nbsp;</span><span style="color: #0000BB">Titi</span><span style="color: #007700">());<br>echo&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br><br>echo&nbsp;</span><span style="color: #DD0000">"----&nbsp;print_r&nbsp;----\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(new&nbsp;</span><span style="color: #0000BB">Titi</span><span style="color: #007700">());<br>echo&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br><br>echo&nbsp;</span><span style="color: #DD0000">"----&nbsp;var_dump&nbsp;----\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(new&nbsp;</span><span style="color: #0000BB">Titi</span><span style="color: #007700">());<br>echo&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br></span>
</span>
</code></pre>
<pre class="output">---- var_export ----
Titi::__set_state(array(
   'x' =&gt; false,
   'y' =&gt; '',
   'z' =&gt; NULL,
))
---- print_r ----
Titi Object
(
    [x:Titi:private] =&gt; 
    [y:protected] =&gt; 
    [z] =&gt; 
)

---- var_dump ----
/users/ensweb/www-prod/TW4B/pres/oophp/demo/exPrintDebug.php:19:
class Titi#4 (3) {
  private $x =&gt;
  bool(false)
  protected $y =&gt;
  string(0) ""
  public $z =&gt;
  NULL
}


</pre>
</div>
<!-- ########################################################################### -->

<!-- ########################################################################### -->

<div class="slide">
<h2>Mot clé final</h2>
<ul>
<li><code>final</code> pour une méthode : la méthode ne peut pas être redéfinie dans une classe dérivée</li>
<li><code>final</code> pour une classe : la classe ne peut pas être dérivée</li>
</ul>
<pre class="code src "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">finalEx&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$donnee&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"exemple"</span><span style="color: #007700">;<br>&nbsp;&nbsp;<br>&nbsp;&nbsp;final&nbsp;function&nbsp;</span><span style="color: #0000BB">maj</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;</span><span style="color: #0000BB">strtoupper</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">donnee</span><span style="color: #007700">);<br>&nbsp;&nbsp;}<br>}<br><br>final&nbsp;class&nbsp;</span><span style="color: #0000BB">finalExtend&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">finalEx&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;<br>&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Fatal&nbsp;error&nbsp;:&nbsp;impossible&nbsp;de&nbsp;redéfinir&nbsp;maj()<br>&nbsp;&nbsp;public&nbsp;function&nbsp;maj()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;$this-&gt;donnee;<br>&nbsp;&nbsp;}&nbsp;*/<br></span><span style="color: #007700">}<br><br></span><span style="color: #FF8000">/*&nbsp;Fatal&nbsp;error&nbsp;:&nbsp;impossible&nbsp;de&nbsp;dériver&nbsp;finalExtend<br>class&nbsp;erreur&nbsp;extends&nbsp;finalExtend&nbsp;{<br>&nbsp;&nbsp;//&nbsp;impossible<br>}<br>*/<br><br></span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">finalEx</span><span style="color: #007700">();<br>echo&nbsp;</span><span style="color: #0000BB">$class</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">maj</span><span style="color: #007700">();<br>echo&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$classExtend&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">finalExtend</span><span style="color: #007700">();<br>echo&nbsp;</span><span style="color: #0000BB">$classExtend</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">maj</span><span style="color: #007700">();<br><br><br></span><span style="color: #0000BB">?&gt;</span>&nbsp;<br></span>
</code></pre>
<pre class="output">EXEMPLE
EXEMPLE 

</pre>
</div>

<!-- ########################################################################### -->
<!-- ########################################################################### -->

<div class="slide">
<h2>Classe et méthode abstraite</h2>
<ul>
<li>Mot clé <code>abstract</code></li>
<li>Une classe abstraite ne peut pas être instanciée</li>
<li>Une méthode abstraite définit sa signature, pas son implémentation</li>
<li>Une méthode abstraite doit être dérivée avec une visibilité supérieure</li>
</ul>
<pre class="code src "><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">abstract&nbsp;class&nbsp;</span><span style="color: #0000BB">AbstractClass<br></span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Force&nbsp;la&nbsp;classe&nbsp;étendue&nbsp;à&nbsp;définir&nbsp;cette&nbsp;méthode<br>&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">abstract&nbsp;protected&nbsp;function&nbsp;</span><span style="color: #0000BB">getValue</span><span style="color: #007700">();<br><br>&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;méthode&nbsp;commune<br>&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">printOut</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getValue</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;}<br>}<br><br>class&nbsp;</span><span style="color: #0000BB">ConcreteClass1&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">AbstractClass<br></span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;</span><span style="color: #0000BB">getValue</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"ConcreteClass1"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;}<br>}<br><br>class&nbsp;</span><span style="color: #0000BB">ConcreteClass2&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">AbstractClass<br></span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;protected&nbsp;function&nbsp;</span><span style="color: #0000BB">getValue</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"ConcreteClass2"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;}<br>}<br><br></span><span style="color: #0000BB">$class1&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">ConcreteClass1</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$class1</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">printOut</span><span style="color: #007700">();<br><br></span><span style="color: #0000BB">$class2&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">ConcreteClass2</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$class2</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">printOut</span><span style="color: #007700">();<br><br><br></span><span style="color: #0000BB">?&gt;</span>&nbsp;<br></span>
</code></pre>
<pre class="output">ConcreteClass1ConcreteClass2 

</pre>
</div>

<!-- ########################################################################### -->

<!-- ########################################################################### -->

<div class="slide">
<h2>Interfaces</h2>
<div class="slidecontent">
<ul>
<li>Permettent de créer du code spécifiant les signatures des méthodes</li>
<li>Sans avoir à définir leur implémentation</li>
<li>Définir avec le mot clé <code>interface</code></li>
<li>Une classe implémente une interface :<br> <code>class maClasse implements monInterface</code></li>
<li>Existence d'interfaces "internes" prédéfinies dans PHP5</li>
</ul>
</div>
</div>

<!-- ########################################################################### -->

<!-- ########################################################################### -->

<div class="slide">
<h2>Déclaration du type des paramètres</h2>
<ul>
<li>«&nbsp;Type hinting&nbsp;» de PHP&nbsp;5&nbsp;:
<ul>
<li>On peut déclarer un type pour les paramètres des fonctions
</li><li>Limités à des noms de classes (et <code>array</code> et <code>callable</code>)
</li><li class="conseq">déjà très utile notamment avec des interfaces
</li><li><code>function MaFonction(MaClasse $param)</code> : $param doit être une instance de la classe MaClasse</li>
<li>Vérification faite à l'exécution. Erreur fatale (<i>catchable</i>…) émise si le paramètre n'est pas une instance de la classe indiquée</li>
</ul>
</li><li>En PHP&nbsp;7, on peut utiliser aussi des types primitifs, comme <code>int</code> ou <code>string</code>&nbsp;:
<a href="https://www.php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration">voir la liste</a>
</li><li>Attention&nbsp;: par défaut, une <code>TypeError</code> est envoyée si le type n'est pas respecté, <strong>sauf</strong>
si la conversion est possible&nbsp;!
</li><li class="conseq">il faut ajouter <code>declare(strict_types=1);</code> pour bénéficier du «&nbsp;typage strict&nbsp;»,
qui renverra bien une <code>TypeError</code> dans tous les cas où le paramètre donné ne respecte pas
la déclaration. <small>Sauf pour les <code>int</code>, qui pourront toujours être convertis en <code>float</code>.</small>
</li></ul>


</div>
<!-- ########################################################################### -->
<div class="slide">
<h2>Déclaration du type de retour</h2>
<ul>
<li>On peut aussi depuis PHP&nbsp;7 déclarer un type de retour pour les fonctions et méthodes
</li><li>Syntaxe&nbsp;: <pre class="src">function toto(): float {
    return 3.14;
}
</pre>
</li><li>On y met les mêmes types que pour les paramètres, avec <code>void</code> en plus
</li><li>Même piège du «&nbsp;mode strict&nbsp;» non activé par défaut
(la valeur de retour, par défaut, est simplement convertie si c'est possible)
</li></ul>
</div>
<div class="slide">
<h2>Types nullifiables</h2>
<ul>
<li>Très souvent en PHP les paramètres et les valeurs de retour sont mises à <code>null</code>
pour certains cas particuliers (par exemple des erreurs)
</li><li class="conseq">ennuyeux si on veut typer la fonction
</li><li>Depuis PHP&nbsp;7.1, on peut utiliser des <i>nullable types</i>,
en ajoutant un point d'interrogation au début du type&nbsp;: par ex <code>function titi(?int $x)</code>
</li><li>Signifie qu'on attend un int, ou null
</li></ul>
</div>


<!-- ########################################################################### -->
<!-- ########################################################################### -->

<div class="slide">
<h2>Héritage vs composition</h2>

<p>Un principe important en POO est de favoriser la <em>composition</em>
plutôt que l'<em>héritage</em> pour mutualiser du code
</p><p>En effet l'héritage a des conséquences pénibles, notamment le 
fait qu'à partir du moment où on a sous-classé une classe, il devient 
difficile de la faire évoluer (tout changement a des conséquences sur 
les classes filles)
</p><p class="conseq">cela contrevient à la modularisation du code — les
 classes sont trop dépendantes les unes des autres, alors que le but de 
la POO est plutôt d'essayer de créer des «&nbsp;boîtes noires&nbsp;» 
dont le comportement interne n'a pas d'influence à l'extérieur
</p><p>En utilisant la composition, on garde l'indépendance entre les classes
</p><p class="conseq">le prix à payer est une syntaxe un peu plus lourde
 dans la classe, et l'obligation parfois d'écrire des méthodes de 
«&nbsp;délégation&nbsp;»

</p><p class="note">ex autom cell: comportement en fonction de la règle, en fonction de l'affichage voulu</p>
</div>

<!-- ########################################################################### -->
<!-- ########################################################################### -->

<div class="slide">
<h2>Traits</h2>

<p><a href="https://www.php.net/manual/en/language.oop5.traits.php">Les <em>traits</em> de PHP</a> sont (principalement) un moyen de faire de la composition,
sans les inconvénients
</p><pre class="src">trait MonTrait {
    function uneMethodeUtile() {
}

class Toto {
    use MonTrait;
}
</pre>
<div class="p">Dans l'exemple ci-dessus, la classe <code>Toto</code> contient la méthode <code>uneMethodeUtile</code>, comme si elle avait hérité de <code>MonTrait</code>, sauf qu'il n'y a pas eu d'héritage&nbsp;:
<ul>
<li>Toto peut très bien étendre une autre classe
</li><li>Toto peut utiliser d'autres traits, pas de problème d'héritage multiple (en cas de conflit de nommage, il faut <em>obligatoirement</em> définir explicitement la méthode concernée dans <code>Toto</code>
</li><li>On peut utiliser une même méthode dans plusieurs classes, sans qu'elles soient liées par le typage
</li></ul>
</div>
<div class="p">Les inconvénients de la composition disparaissent, puisque tout se passe comme si la méthode était définie dans la classe&nbsp;:
 <ul>
<li>syntaxe simple
</li><li>pas besoin d'écrire des méthodes de délégation
</li></ul>
</div>
</div>

<!-- ########################################################################### -->
<!-- ########################################################################### -->

<div class="slide">
<h2>Méthodes magiques</h2>
<div class="slidecontent">
<ul>
<li>Méthodes <code>__sleep</code> et <code>__wakeup</code> : code à exécuter lors de la sérialisation et désérialisation d'un objet</li>
<li>Utile pour les ressources (connection BDD, ressource fichier)</li>
<!-- <li>Méthode <code>__toString</code> : code à exécuter lorsqu'une instance est  convertie en chaîne de caractères avec <code>echo</code> ou <code>print</code></li> -->
<!-- <li><code>$class = new ClasseTest('Bonjour');<br/> -->
<!-- echo $class;</code></li> -->
<li>Méthodes <code>__get __set __call</code> pour gérer la surcharge objet  (voir le <a href="http://fr.php.net/manual/fr/language.oop5.overloading.php" class="newTab">manuel</a>)</li>
<li class="conseq">à utiliser pour gérer les erreurs, pas «&nbsp;pour de vrai&nbsp;»&nbsp;! <span class="note">peu efficace + code moins lisible, moins analysable par des outils + leaky abstraction, voir un exemple dans la doc</span></li>
</ul>
</div>
</div>

<!-- ########################################################################### -->



</div> <!-- fin #presentation -->


</div> <!-- fin #contenu -->

<footer class="license">
	<a class="icone" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
		<img alt="Licence Creative Commons CC-BY-NC-SA" style="border-width:0" src="Le%20mod%C3%A8le%20objet%20de%20PHP5%20%E2%80%94%20Alexandre%20Niveau%20%E2%80%94%20Universit%C3%A9%20de%20Caen%20Normandie_files/88x31.png">
	</a>
	<p class="texte">
		Ce cours est mis à disposition selon les termes de la <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">licence Creative Commons Attribution — Pas d’utilisation commerciale — Partage dans les mêmes conditions 4.0 International</a>.
	</p></footer>
<script>
document.addEventListener("DOMContentLoaded", function () {
	function toggleProj() {
		const currentParams = new URLSearchParams(window.location.search);
		if (currentParams.get('mode') === 'proj') {
			console.log('found proj');
			document.documentElement.classList.remove('proj');
			currentParams.delete('mode');
		} else {
			console.log('not found proj');
			document.documentElement.classList.add('proj');
			currentParams.set('mode', 'proj');
		}
		window.history.pushState({}, '', '?' + currentParams + window.location.hash);
	};

	var buttons = document.querySelectorAll('.proj_switch button'), i;
	for (i = 0; i < buttons.length; ++i) {
		buttons[i].addEventListener("click", toggleProj);
	}

	document.addEventListener("keypress", function(e) {
		if (e.target == document.body && String.fromCharCode(e.keyCode || e.charCode) == "m") {
			toggleProj();
		}
	});

	/* ajout de liens aux titres qui ont un id */
	let slidesWithId = document.querySelectorAll('.slide[id]');
	for (const slide of slidesWithId) {
		const link = document.createElement('a');
		link.href = '#' + slide.id;
		link.classList.add('slide-link');
		link.title = 'Lien vers ce slide';
		link.textContent = '#';
		slide.insertAdjacentElement('afterbegin', link);
	}


});
</script>


</body></html>